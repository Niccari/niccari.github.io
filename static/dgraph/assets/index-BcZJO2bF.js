import{r as Z,g as K,u as ee,a as I,b as te,c as re,F as D,d as ne,e as oe,R as se}from"./status-BkODWa_b.js";import{r as ie}from"./ui-Cb9g4YMY.js";import{r as ae}from"./math-C4VmoqT3.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();var $={exports:{}},A={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V;function le(){if(V)return A;V=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function o(s,r,n){var i=null;if(n!==void 0&&(i=""+n),r.key!==void 0&&(i=""+r.key),"key"in r){n={};for(var a in r)a!=="key"&&(n[a]=r[a])}else n=r;return r=n.ref,{$$typeof:e,type:s,key:i,ref:r!==void 0?r:null,props:n}}return A.Fragment=t,A.jsx=o,A.jsxs=o,A}var W;function ce(){return W||(W=1,$.exports=le()),$.exports}var l=ce(),ue=ie(),k={exports:{}},H={};/**
 * @license React
 * react-compiler-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y;function he(){if(Y)return H;Y=1;var e=Z().__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;return H.c=function(t){return e.H.useMemoCache(t)},H}var X;function de(){return X||(X=1,k.exports=he()),k.exports}var M=de();const d={Rainbow:"Rainbow",Fire:"Fire",Green:"Green",Ice:"Ice",Heat:"Heat",Monochrome:"Monochrome",Pastel:"Pastel"},F={Ortho:"Ortho",Polar:"Polar"},pe={equation:"2(sin(5.01x) + cos(4.99x))sin(10x)",axis:{xStep:.001,xMin:-Math.PI,xMax:Math.PI,yMin:-Math.PI,yMax:Math.PI},coordinate:F.Polar,chartAppearance:{draw:{pattern:d.Rainbow,colorStep:256/(2*Math.PI/.001)},thickness:5}},G=(()=>{const t=new URL(document.location.href).searchParams.get("setting")||"";try{return JSON.parse(atob(t))}catch{return pe}})(),x={UpdateAll:"UpdateAll",UpdateSimulation:"UpdateSimulation",UpdateAppearance:"UpdateAppearance",None:"None"},R=class R{constructor(t,o,s){this.snapshots=t,this.drawer=o,this.update(s)}async update(t,o){const s=R.toXRange(t.axis),r=R.findAction(t,o);return this.snapshots.update(t.equation,s,t.chartAppearance.draw,r)}draw(t,o,s,r){const{coordinate:n,axis:i}=o,{thickness:a}=o.chartAppearance,u=this.snapshots.get(n);this.drawer.draw(t,u,i,a,s,r)}};R.toXRange=t=>{const{xMin:o,xMax:s,xStep:r}=t,n=Math.floor((s-o)/r)+1;return new Array(n).fill(0).map((i,a)=>o+a*r)},R.findAction=(t,o)=>{if(!o)return x.UpdateAll;const s=t.equation!==o.equation||t.axis!==o.axis,r=t.chartAppearance.draw!==o.chartAppearance.draw||t.axis!==o.axis;return s&&r?x.UpdateAll:s?x.UpdateSimulation:r?x.UpdateAppearance:x.None};let L=R;const P=class P{draw(t,o,s,r,n,i){if(t.clearRect(0,0,n,i),o.length<2)return;t.lineWidth=r;let a=0;for(;a<o.length-1;){const u=o[a].drawSetting.color;t.strokeStyle=u,t.beginPath();const[c,h]=P.rescalePoint(o[a],s,n,i);for(t.moveTo(c,h);a<o.length-1&&o[a].drawSetting.color===u;){a++;const[m,p]=P.rescalePoint(o[a],s,n,i);t.lineTo(m,p)}t.stroke()}}};P.rescalePoint=(t,o,s,r)=>{const{xMin:n,xMax:i,yMin:a,yMax:u}=o;return[(t.value.x-n)/(i-n)*s,(1-(t.value.y-a)/(u-a))*r]};let B=P;var me=ae();const xe=K(me);class fe{constructor(){this.create=async(t,o)=>{const s=new Array(o.length);for(let r=0;r<o.length;r++){const n=o[r];try{const i=n*this.degreeConversionFactor,a=this.mexp.eval(t,[{type:3,show:"",precedence:1,token:"x",value:"x"}],{x:i});typeof a=="number"?s[r]={x:n,y:a}:s[r]={x:n,y:NaN}}catch(i){throw new Error(`Cannot eval: ${i}`)}}return Promise.resolve(s)},this.mexp=new xe,this.degreeConversionFactor=180/Math.PI}}const _=class _{constructor(t,o){this.getValues=async(s,r,n)=>n===x.UpdateAll||n===x.UpdateSimulation?this.simulator.create(s,r).catch(i=>Promise.reject(i)):this.snapshotsOrtho.map(i=>i.value),this.getDrawSettings=async(s,r,n)=>n===x.UpdateAll||n===x.UpdateAppearance?this.visualizer.create(s,r):this.snapshotsOrtho.map(i=>i.drawSetting),this.update=async(s,r,n,i)=>{if(i===x.None)return;const a=await this.getValues(s,r,i).catch(c=>Promise.reject(c)),u=await this.getDrawSettings(r,n,i);this.snapshotsOrtho=_.toSnapshots(r,a,u),this.snapshotsPolar=this.snapshotsOrtho.map(c=>({...c,value:{x:Math.abs(c.value.y)*Math.cos(c.value.x),y:Math.abs(c.value.y)*Math.sin(c.value.x)}}))},this.simulator=t,this.visualizer=o,this.snapshotsOrtho=[],this.snapshotsPolar=[]}get(t){switch(t){case F.Ortho:return this.snapshotsOrtho;case F.Polar:return this.snapshotsPolar;default:return this.snapshotsOrtho}}};_.toSnapshots=(t,o,s)=>new Array(t.length).fill(0).map((n,i)=>i).map(n=>({x:t[n]??0,value:o[n]??{x:0,y:0},drawSetting:s[n]??{color:"#000000",thickness:1}}));let J=_;const f=class f{constructor(t){this.colorTable=[],this.gradientRainbows=[{position:0,red:255,green:0,blue:0},{position:43,red:255,green:255,blue:0},{position:85,red:0,green:255,blue:0},{position:128,red:0,green:255,blue:255},{position:171,red:0,green:0,blue:255},{position:223,red:255,green:0,blue:255},{position:255,red:255,green:0,blue:0}],this.gradientWarm=[{position:0,red:255,green:0,blue:0},{position:128,red:255,green:255,blue:0},{position:255,red:255,green:0,blue:0}],this.gradientForest=[{position:0,red:255,green:255,blue:0},{position:128,red:0,green:255,blue:0},{position:255,red:255,green:255,blue:0}],this.gradientCool=[{position:0,red:0,green:0,blue:255},{position:128,red:0,green:255,blue:255},{position:255,red:0,green:0,blue:255}],this.gradientHeat=[{position:0,red:255,green:255,blue:0},{position:43,red:255,green:0,blue:0},{position:85,red:0,green:0,blue:255},{position:128,red:0,green:0,blue:0},{position:171,red:0,green:0,blue:255},{position:223,red:255,green:0,blue:0},{position:255,red:255,green:255,blue:0}],this.gradientMonochrome=[{position:0,red:0,green:0,blue:0},{position:128,red:255,green:255,blue:255},{position:255,red:0,green:0,blue:0}],this.gradientPastel=[{position:0,red:255,green:154,blue:154},{position:85,red:255,green:255,blue:154},{position:170,red:154,green:255,blue:255},{position:255,red:255,green:154,blue:154}],this.config=t,this.colorStartIndex=0,this.colorIterateIndex=0;const o=(()=>{switch(t.pattern){case d.Rainbow:return this.gradientRainbows;case d.Fire:return this.gradientWarm;case d.Green:return this.gradientForest;case d.Ice:return this.gradientCool;case d.Heat:return this.gradientHeat;case d.Monochrome:return this.gradientMonochrome;case d.Pastel:return this.gradientPastel;default:return this.gradientRainbows}})();let s=0,r=1;for(let n=0;n<256;n+=1){const i=o[s],a=o[r];if(!i||!a)return;const u=(n-i.position)/(a.position-i.position),c=i.red+u*(a.red-i.red),h=i.green+u*(a.green-i.green),m=i.blue+u*(a.blue-i.blue),p=f.colorToHex(c),g=f.colorToHex(h),b=f.colorToHex(m),S=`#${p}${g}${b}`;this.colorTable.push({position:n,red:c,green:h,blue:m,hex:S}),a.position===n&&(s=r,r+=1)}}fetchColor(t){const o=Math.floor(t);if(t===o){const p=this.colorTable[o];return(p==null?void 0:p.hex)??"#000000"}const s=Math.ceil(t)!==this.colorTable.length-1?Math.ceil(t):0,r=t-o,n=1-r,i=this.colorTable[o],a=this.colorTable[s];if(!i||!a)return"#000000";const u={red:Math.floor(r*i.red+n*a.red),green:Math.floor(r*i.green+n*a.green),blue:Math.floor(r*i.blue+n*a.blue)},c=f.colorToHex(u.red),h=f.colorToHex(u.green),m=f.colorToHex(u.blue);return`#${c}${h}${m}`}next(){const t=this.fetchColor(Math.floor(this.colorIterateIndex));return this.colorIterateIndex=(this.colorIterateIndex+this.config.colorStep)%256,t}endIteration(){this.colorStartIndex=(this.colorStartIndex+this.config.colorStep)%256,this.colorIterateIndex=this.colorStartIndex}};f.colorToHex=t=>{const o=Math.round(t).toString(16);return o.length===1?`0${o}`:o};let z=f;class ge{constructor(){this.create=async(t,o)=>{const s=new z(o);return t.map(()=>({color:s.next()}))}}}const be=new ge,Se=new fe,we=new J(Se,be),ve=new B,Q=new L(we,ve,G),ye={setting:G,error:void 0},je=te(ye),O=()=>{const[e,t]=ee(je),[o,s]=I.useTransition();return{...e,isLoading:o,updateSimulationState:n=>{s(async()=>{try{await Q.update(n,e.setting),t({setting:n,error:void 0})}catch(i){t(a=>({...a,error:i}))}})}}},Re=()=>{const e=M.c(6),t=I.useRef(null),{setting:o}=O(),s=Me;let r,n;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=()=>{const c=t==null?void 0:t.current;c&&s(c)},n=[],e[0]=r,e[1]=n):(r=e[0],n=e[1]),I.useEffect(r,n);let i,a;e[2]!==o?(i=()=>{const c=t==null?void 0:t.current;if(!c)return;const h=c.getContext("2d");h&&Q.draw(h,o,c.width,c.height)},a=[o],e[2]=o,e[3]=i,e[4]=a):(i=e[3],a=e[4]),I.useEffect(i,a);let u;return e[5]===Symbol.for("react.memo_cache_sentinel")?(u=l.jsx("canvas",{className:"canvas",ref:t}),e[5]=u):u=e[5],u};function Me(e){const t=Math.min(1e3*window.devicePixelRatio,4e3);e.width=t,e.height=t}const Ae=()=>{const e=M.c(3),{setting:t}=O();let o,s;return e[0]!==t?(o=()=>{const r=btoa(JSON.stringify(t)),n=`${window.location.pathname}?setting=${r}`;window.history.replaceState(null,"update setting",n)},s=[t],e[0]=t,e[1]=o,e[2]=s):(o=e[1],s=e[2]),I.useEffect(o,s),null},Ie=e=>{const t=M.c(11),{isLoading:o,error:s}=e;let r;t[0]!==o?(r=o&&l.jsx("span",{children:"⏰"}),t[0]=o,t[1]=r):r=t[1];let n;t[2]!==s?(n=s&&l.jsx("span",{children:"❌"}),t[2]=s,t[3]=n):n=t[3];let i;t[4]!==s||t[5]!==o?(i=!o&&!s&&l.jsx("span",{children:"✅"}),t[4]=s,t[5]=o,t[6]=i):i=t[6];let a;return t[7]!==r||t[8]!==n||t[9]!==i?(a=l.jsxs(l.Fragment,{children:[r,n,i]}),t[7]=r,t[8]=n,t[9]=i,t[10]=a):a=t[10],a},Pe=()=>{const e=M.c(40),{isLoading:t,error:o}=O(),{values:s,handleChange:r,handleBlur:n,handleSubmit:i,isValid:a}=re();let u;e[0]!==n||e[1]!==r||e[2]!==s.equation?(u=l.jsxs("label",{className:"SettingFormText",children:["f(x)=",l.jsx(D,{type:"text",name:"equation",onChange:r,onBlur:n,value:s.equation,placeholder:"方程式を入れる",required:!0,className:"SettingFormEquation"})]}),e[0]=n,e[1]=r,e[2]=s.equation,e[3]=u):u=e[3];let c;e[4]!==o||e[5]!==t?(c=l.jsx(Ie,{isLoading:t,error:o}),e[4]=o,e[5]=t,e[6]=c):c=e[6];let h;e[7]!==u||e[8]!==c?(h=l.jsxs("div",{className:"SettingFormItem",children:[u,c]}),e[7]=u,e[8]=c,e[9]=h):h=e[9];let m,p,g,b,S,T,C;e[10]===Symbol.for("react.memo_cache_sentinel")?(m=l.jsx("option",{value:d.Rainbow,children:"虹"}),p=l.jsx("option",{value:d.Fire,children:"炎"}),g=l.jsx("option",{value:d.Green,children:"木漏れ日"}),b=l.jsx("option",{value:d.Ice,children:"氷結"}),S=l.jsx("option",{value:d.Heat,children:"熱"}),T=l.jsx("option",{value:d.Monochrome,children:"モノクロ"}),C=l.jsx("option",{value:d.Pastel,children:"パステル"}),e[10]=m,e[11]=p,e[12]=g,e[13]=b,e[14]=S,e[15]=T,e[16]=C):(m=e[10],p=e[11],g=e[12],b=e[13],S=e[14],T=e[15],C=e[16]);let w;e[17]!==n||e[18]!==r||e[19]!==s.chartAppearance.draw.pattern?(w=l.jsx("div",{className:"SettingFormItem",children:l.jsxs("label",{className:"SettingFormText",children:["色パターン",l.jsxs("select",{name:"chartAppearance.draw.pattern",onChange:r,onBlur:n,value:s.chartAppearance.draw.pattern,children:[m,p,g,b,S,T,C]})]})}),e[17]=n,e[18]=r,e[19]=s.chartAppearance.draw.pattern,e[20]=w):w=e[20];let v;e[21]!==n||e[22]!==r||e[23]!==s.chartAppearance.thickness?(v=l.jsx("div",{className:"SettingFormItem",children:l.jsxs("label",{className:"SettingFormText",children:["線の太さ",l.jsx(D,{type:"number",name:"chartAppearance.thickness",onChange:r,onBlur:n,value:s.chartAppearance.thickness})]})}),e[21]=n,e[22]=r,e[23]=s.chartAppearance.thickness,e[24]=v):v=e[24];let N,E;e[25]===Symbol.for("react.memo_cache_sentinel")?(N=l.jsx("option",{value:F.Ortho,children:"直交座標"}),E=l.jsx("option",{value:F.Polar,children:"極座標"}),e[25]=N,e[26]=E):(N=e[25],E=e[26]);let y;e[27]!==n||e[28]!==r||e[29]!==s.coordinate?(y=l.jsx("div",{className:"SettingFormItem",children:l.jsxs("label",{className:"SettingFormText",children:["座標系",l.jsxs("select",{name:"coordinate",onChange:r,onBlur:n,value:s.coordinate,children:[N,E]})]})}),e[27]=n,e[28]=r,e[29]=s.coordinate,e[30]=y):y=e[30];const U=!a;let j;e[31]!==U?(j=l.jsx("div",{className:"SettingFormItem",children:l.jsx("button",{type:"submit",disabled:U,children:"設定を更新する"})}),e[31]=U,e[32]=j):j=e[32];let q;return e[33]!==i||e[34]!==w||e[35]!==v||e[36]!==y||e[37]!==j||e[38]!==h?(q=l.jsxs(ne,{onSubmit:i,className:"SettingFormFrame",children:[h,w,v,y,j]}),e[33]=i,e[34]=w,e[35]=v,e[36]=y,e[37]=j,e[38]=h,e[39]=q):q=e[39],q},Fe=()=>{const e=M.c(5),{updateSimulationState:t}=O();let o;e[0]!==t?(o=n=>{t(n)},e[0]=t,e[1]=o):o=e[1];let s;e[2]===Symbol.for("react.memo_cache_sentinel")?(s=l.jsx(Pe,{}),e[2]=s):s=e[2];let r;return e[3]!==o?(r=l.jsx(oe,{initialValues:G,onSubmit:o,validate:Te,children:s}),e[3]=o,e[4]=r):r=e[4],r};function Te(e){const t={},{equation:o,chartAppearance:s}=e;return o.length===0&&(t.equation="式を入れてください"),s.thickness<=0&&(t.equation="線の太さは0以上にしてください"),t}const Ce=()=>{const e=M.c(1);let t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t=l.jsxs(l.Fragment,{children:[l.jsx(Fe,{}),l.jsx(Re,{}),l.jsx(Ae,{})]}),e[0]=t):t=e[0],t},Ne=document.getElementById("app"),Ee=ue.createRoot(Ne);Ee.render(l.jsx(se.StrictMode,{children:l.jsx(Ce,{})}));
